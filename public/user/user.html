<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Info</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;0,1000;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,1000&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <style>
        div#UserContent {
            color: aliceblue;
        }

        .content-section {
            display: none;
            /* Hide all content sections by default */
        }

        #navBar {
            border-radius: 30px 30px 30px 30px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.31);
        }

        #navBarMovies {
            border-radius: 30px 30px 30px 30px;
            box-shadow: 2px 2px 10px rgba(128, 128, 128, 0.31);
        }

        #navBarButton {
            background-color: rgb(255, 255, 255);
            border-color: rgba(255, 255, 255, 0);
            border-radius: 100px;
        }
    </style>
</head>

<body class="bg-black">
    <div class="cover-container d-f p-3 mx-auto flex-column">

        <nav class="navbar navbar-expand-sm p-3 m-2 bg-dark" id="navBar" style="background-color: #000;"
            aria-label="Header">
            <div class="container-fluid">
                <a href="/" class="d-flex align-items-center mt-2 mb-2 mb-lg-0 pe-3 text-white text-decoration-none">
                    <!-- <img src="../assets/brand/SPdvdRentals.png" class="appLogo bi me-2" width="auto" height="32"
                        role="img" /> -->
                </a>
                <button class="navbar-toggler btn btn-dark" id="navBarButton" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mt-2 me-auto mb-2 mb-lg-0" id="ComFont">
                        <li><a href="/" class="nav-link px-2 text-light fs-5">&nbspHomepage</a></li>
                        <li><a href="/importMovies" class="nav-link px-3 text-secondary fs-5">Import Movies</a>
                        <li><a href="/userpage" class="nav-link px-3 text-secondary fs-5">Users</a>

                        </li>
                        <a id="AdminPrivilleges" class="nav-link px-3 text-warning fs-5"></a>
                    </ul>


                    <!-- <form class="col-12 col-lg-auto col-lg-5 mb-3 mb-lg-0 me-lg-3" role="search">
                                <label for="searchBar">Email address</label>
                                <input type="search" class="form-control form-control-dark text-bg-dark" id="searchBar"
                                    placeholder="Search for Movie titles, Categories and More" aria-label="Search">
                            </form> -->
                    <!-- <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form> -->

                </div>
            </div>
        </nav>
    </div>
    <!--
    <div class="container row" id="UserContent">
        <h1>User Page</h1>

        <div class="col-4">

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Retrieve User</h3>
                <p>
                    The data displayed is only for the user who is currently logged in
                    at User ID 13 (Hard-coded).
                </p>
                <p id="getUserData"></p>
            </div>

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Create User</h3>
                <p>
                    To create a new user account, choose a username,
                    password, and choose if you want
                    to be a Customer or movie Publisher.
                </p>

                <form id="addUser" style="margin-top: 2rem;">
                    <label for="Username">Username</label><br>
                    <input type="text" id="Username" name="Username" value=""><br>
                    <label for="Password">Password</label><br>
                    <input type="password" id="Password" name="Password" value=""><br><br>

                    <p>What is your role?</p>

                    <select name="Role" id="Role">
                        <option value="Customer">Customer</option>
                        <option value="Publisher">Publisher</option>
                    </select>

                    <button type="submit" class="btn btn-primary">Create User</button>
                </form>
            </div>
        </div>

        <div class="col-4">
            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Update User Password</h3>
                <p>This function can work only for the user who is currently logged in
                    (UserID 13, Hard-coded).
                </p>
                <form id="updateUser" style="margin-top: 2rem;">
                    <label for="PasswordUpdate">New Password</label><br>
                    <input type="password" id="PasswordUpdate" name="PasswordUpdate" value=""><br><br>

                    <button type="submit" class="btn btn-primary">Update User</button>
                </form>
            </div>

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Delete User</h3>
                <p>Delete any User by giving the specific UserID.</p>

                <form id="deleteUser" style="margin-top: 2rem;">
                    <label for="deleteID">UserID</label><br>
                    <input type="Number" id="deleteID" name="Number" value=""><br><br>
                    <button type="submit" class="btn btn-primary">Delete User</button>
                </form>
            </div>
        </div>

        <div class="col-4">
            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Buy a Movie (For Customer Only)</h3>
                <form id="buyMovie" style="margin-top: 2rem;">
                    <label for="buyWithCustomerID">Enter your Customer ID</label><br>
                    <input type="number" id="buyWithCustomerID" name="buyWithCustomerID" value=""><br><br>
                    <label for="movieNum">Enter Movie ID of the film you want to buy</label><br>
                    <input type="number" id="movieNum" name="movieNum" value=""><br><br>
                    <button type="submit" class="btn btn-primary">Confirm Purchase</button>
                </form>
                <p id="buyMovieConfirmed"></p>
            </div>
        </div>
    </div>
-->

    <div class="container text-light">

        <h1>User Information</h1>
        <!-- Dropdown menu -->
        <select id="contentSelector">
            <option value="reviews">Reviews</option>
            <option value="purchases">Purchases</option>
        </select>

        <!-- Content sections -->
        <div id="reviews" class="content-section">
            <!-- Data 1 goes here -->
            <h5>Your Reviews</h5>
            <p id="reviewdata"></p>
        </div>

        <div id="purchases" class="content-section">
            <!-- Data 2 goes here -->
            <h5>Your Purchases</h5>
            <p id="purchasedata"></p>
        </div>

    </div>

    <!-- JQuery, Axios -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        const baseUrl = 'http://localhost:3000';
        const loggedInUserID = 1;

        // Function to fetch data from the backend using Axios
        function fetchDataFromAPI(apiURL) {
            return axios.get(apiURL)
                .then((response) => {
                    if (apiURL === `${baseUrl}/reviews/data/${loggedInUserID}`) {
                        const data = response.data
                        data.forEach(review => {//M.title, M.release_date, R.Rating, R.Comments
                            const reviewHTML = `
                        <div class='container border border-2 border-white rounded mx-3 my-4'>
                            <p>Title: ${review.title}</p>
                            <p>Release Date: ${review.release_date}</p>
                            <p>Rating: ${review.Rating}</p>
                            <p>Comments: ${review.Comments}</p>
                        </div>
                        `;
                            $('#reviewdata').append(reviewHTML);
                        });
                    }
                    else if (apiURL === `${baseUrl}/purchase/${loggedInUserID}`) {
                        const data = response.data
                        data.forEach(purchase => { //M.title, M.Price, M.release_date, M.runtime, P.DateBought
                            const purchaseHTML = `
                        <div class='container border border-2 border-white rounded mx-3 my-4'>
                            <p>Title: ${purchase.title}</p>
                            <p>Price: $${purchase.Price}</p>
                            <p>Release Date: ${purchase.release_date}</p>
                            <p>Runtime: ${purchase.runtime} mins</p>
                            <p>Date Bought: ${purchase.DateBought}</p>
                        </div>
                        `;
                            $('#purchasedata').append(purchaseHTML);
                        });
                    }

                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    return {}; // Return an empty object or handle the error appropriately
                });
        }

        // Function to update the displayed content
        function updateDisplayedContent(selectedValue, data) {
            const allContentSections = $('.content-section');

            allContentSections.hide();

            const selectedContentSection = $('#' + selectedValue);
            selectedContentSection.show();
        }

        var dropdownSelection, dropdownData;

        document.addEventListener('DOMContentLoaded', async function () {
            // const selectedValue = $(this).val();

            // Fetch data from multiple APIs using Axios
            const reviewAPI = `${baseUrl}/reviews/data/${loggedInUserID}`;
            const purchaseAPI = `${baseUrl}/purchase/${loggedInUserID}`;

            const requests = [
                fetchDataFromAPI(reviewAPI),
                fetchDataFromAPI(purchaseAPI)
            ];

            try {
                const [reviews, purchases] = await Promise.all(requests);
                const data = {
                    reviews: reviews,
                    purchases: purchases
                };
                dropdownData = data;
                // updateDisplayedContent(selectedValue, data);
                //console.log('Selected value: ' + selectedValue);

            } catch (error) {
                console.error('Error fetching data:', error);
            }

        });

        $('#contentSelector').on('change', async function () {
            const selectedValue = $(this).val();
            dropdownSelection = selectedValue;
            updateDisplayedContent(dropdownSelection, dropdownData);
        });

        // Event listener for dropdown menu change
        // $('#contentSelector').on('change', async function () {
        //     const selectedValue = $(this).val();

        //     // Fetch data from multiple APIs using Axios
        //     const reviewAPI = `${baseUrl}/reviews/data/${loggedInUserID}`;
        //     const purchaseAPI = `${baseUrl}/purchase/${loggedInUserID}`;

        //     const requests = [
        //         fetchDataFromAPI(reviewAPI),
        //         fetchDataFromAPI(purchaseAPI)
        //     ];

        //     try {
        //         const [reviews, purchases] = await Promise.all(requests);
        //         const data = {
        //             reviews: reviews,
        //             purchases: purchases
        //         };
        //         updateDisplayedContent(selectedValue, data);
        //         console.log('Selected value: ' + selectedValue);

        //     } catch (error) {
        //         console.error('Error fetching data:', error);
        //     }
        // });

        /*
        // retrieve user data
        axios.get(`${baseUrl}/user/${loggedInUserID}`)
            .then((response) => {
                const data = response.data[0];
                const dataHtml = `
        <p> <em>UserID:</em> ${data.UserID} </p>
        <p> <em>Username:</em> ${data.Username}</p>
        <p> <em>Password:</em> ${data.Password}</p>
        <p> <em>Role:</em> ${data.Role} </p>`;

                $('#getUserData').append(dataHtml);
            })
            .catch((error) => {
                console.log(error);
            });

        $("#addUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                Username: $('#Username').val(),
                Password: $("#Password").val(),
                Role: $('#Role').val()
            };

            // create the user
            axios.post(`${baseUrl}/user`, requestBody)
                .then((response) => {
                    // reset form value.
                    $('#addUser').val('');
                    alert('User added');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#updateUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                Password: $("#PasswordUpdate").val()
            };

            // update the user
            axios.put(`${baseUrl}/user/${loggedInUserID}`, requestBody)
                .then((response) => {
                    // reset form value.
                    $('#PasswordUpdate').val('');
                    alert('User updated');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#deleteUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                UserID: $('#deleteID').val()
            }

            // delete the user
            axios.delete(`${baseUrl}/user/${requestBody.UserID}`)
                .then((response) => {
                    // reset form value.
                    $('#deleteUser').val('');
                    alert('User deleted');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#buyMovie").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                CustomerID: $('#buyWithCustomerID').val(),
                MovieID: $('#movieNum').val()
            };

            // Purchase movie
            axios.post(`${baseUrl}/user/buymovie`, requestBody)
                .then((response) => {
                    // $('#buyWithUserID').val();
                    // $('#movieNum').val();
                    alert('Movie Purchased!');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });
*/
    </script>

    <main>
        <section>
            <div class="container mt-5 pt-5">
                <div id="main" class="row ">
                </div>
            </div>
        </section>
    </main>

</body>

</html>