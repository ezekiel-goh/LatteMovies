<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;0,1000;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,1000&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <style>
        body {
            background-color: lightgray;
        }

        nav {
            background-color: black;
            padding-top: 5px;
            padding-bottom: 5px;
            width: 100%;
        }

        li {
            display: inline;
            margin-left: 1em;
            margin-right: 1em;
        }

        a {
            color: white;
        }
    </style>
</head>

<body>
    <nav>
        <ul>
            <li><a href="javascript:void(0)">Home</a></li>
            <li><a href="javascript:void(0)">Import</a></li>
            <li><a href="javascript:void(0)">User</a></li>
            <li><a href="javascript:void(0)">About</a></li>
        </ul>
    </nav>

    <div class="container row">
        <h1>User Page</h1>

        <div class="col-4">

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Retrieve User</h3>
                <p>
                    The data displayed is only for the user who is currently logged in
                    at User ID 13 (Hard-coded).
                </p>
                <p id="getUserData"></p>
            </div>

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Create User</h3>
                <p>
                    To create a new user account, choose a username,
                    password, and choose if you want
                    to be a Customer or movie Publisher.
                </p>

                <form id="addUser" style="margin-top: 2rem;">
                    <label for="Username">Username</label><br>
                    <input type="text" id="Username" name="Username" value=""><br>
                    <label for="Password">Password</label><br>
                    <input type="password" id="Password" name="Password" value=""><br><br>

                    <p>What is your role?</p>

                    <select name="Role" id="Role">
                        <option value="Customer">Customer</option>
                        <option value="Publisher">Publisher</option>
                    </select>

                    <button type="submit" class="btn btn-primary">Create User</button>
                </form>
            </div>
        </div>

        <div class="col-4">
            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Update User Password</h3>
                <p>This function can work only for the user who is currently logged in
                    (UserID 13, Hard-coded).
                </p>
                <form id="updateUser" style="margin-top: 2rem;">
                    <label for="PasswordUpdate">New Password</label><br>
                    <input type="password" id="PasswordUpdate" name="PasswordUpdate" value=""><br><br>

                    <button type="submit" class="btn btn-primary">Update User</button>
                </form>
            </div>

            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Delete User</h3>
                <p>Delete any User by giving the specific UserID.</p>

                <form id="deleteUser" style="margin-top: 2rem;">
                    <label for="deleteID">UserID</label><br>
                    <input type="Number" id="deleteID" name="Number" value=""><br><br>
                    <button type="submit" class="btn btn-primary">Delete User</button>
                </form>
            </div>
        </div>

        <div class="col-4">
            <div class="container mt-2 mb-2 ml-3 mr-3 pb-2 border border-dark">
                <h3>Buy a Movie (For Customer Only)</h3>
                <form id="buyMovie" style="margin-top: 2rem;">
                    <label for="buyWithCustomerID">Enter your Customer ID</label><br>
                    <input type="number" id="buyWithCustomerID" name="buyWithCustomerID" value=""><br><br>
                    <label for="movieNum">Enter Movie ID of the film you want to buy</label><br>
                    <input type="number" id="movieNum" name="movieNum" value=""><br><br>
                    <button type="submit" class="btn btn-primary">Confirm Purchase</button>
                </form>
                <p id="buyMovieConfirmed"></p>
            </div>
        </div>
    </div>




    <!-- JQuery, Axios -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        const baseUrl = 'http://localhost:3000';
        //  This login will only work when there is an existing record
        // at UserID index 13. Choose another existing UserID
        // to display the details of other User records.
        // The UserID is hardcoded as the Login function does
        // not exist yet.
        const loggedInUserID = 13;

        // retrieve user data
        axios.get(`${baseUrl}/user/${loggedInUserID}`)
            .then((response) => {
                const data = response.data[0];
                const dataHtml = `
        <p> <em>UserID:</em> ${data.UserID} </p>
        <p> <em>Username:</em> ${data.Username}</p>
        <p> <em>Password:</em> ${data.Password}</p>
        <p> <em>Role:</em> ${data.Role} </p>`;

                $('#getUserData').append(dataHtml);
            })
            .catch((error) => {
                console.log(error);
            });

        $("#addUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                Username: $('#Username').val(),
                Password: $("#Password").val(),
                Role: $('#Role').val()
            };

            // create the user
            axios.post(`${baseUrl}/user`, requestBody)
                .then((response) => {
                    // reset form value.
                    $('#addUser').val('');
                    alert('User added');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#updateUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                Password: $("#PasswordUpdate").val()
            };

            // update the user
            axios.put(`${baseUrl}/user/${loggedInUserID}`, requestBody)
                .then((response) => {
                    // reset form value.
                    $('#PasswordUpdate').val('');
                    alert('User updated');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#deleteUser").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                UserID: $('#deleteID').val()
            }

            // delete the user
            axios.delete(`${baseUrl}/user/${requestBody.UserID}`)
                .then((response) => {
                    // reset form value.
                    $('#deleteUser').val('');
                    alert('User deleted');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

        $("#buyMovie").submit((event) => {
            // prevents the page from refreshing
            event.preventDefault();

            const requestBody = {
                CustomerID: $('#buyWithCustomerID').val(),
                MovieID: $('#movieNum').val()
            };

            // Purchase movie
            axios.post(`${baseUrl}/user/buymovie`, requestBody)
                .then((response) => {
                    // $('#buyWithUserID').val();
                    // $('#movieNum').val();
                    alert('Movie Purchased!');
                    return;
                })
                .catch((error) => {
                    console.log(error);
                });
        });

    </script>
</body>

</html>